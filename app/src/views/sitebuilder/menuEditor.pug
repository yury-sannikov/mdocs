extends ./layout/layout.pug

block head
  title #{application} &middot; Menu

block styles
  style.
    ul.jqtree-tree {
      list-style: none outside;
      margin-left: 0;
      margin-bottom: 0;
      padding: 0; }
      .jqtree-element span[role='treeitem']
      {
        width: 30%;
        display: inline-block;
      }
      .jqtree-element.jqtree_common .chosen-container{
        width: 250px;
        right: 50px;
        position: absolute;
      }
      ul.jqtree-tree ul.jqtree_common {
        list-style: none outside;
        /*margin-left: 12px;*/
        margin-right: 0;
        margin-bottom: 0;
        padding: 0;
        display: block; }
      ul.jqtree-tree li.jqtree-closed > ul.jqtree_common {
        display: none; }
      ul.jqtree-tree li.jqtree_common {
        clear: both;
        list-style-type: none; }
      ul.jqtree-tree .jqtree-toggler {
        border-bottom: none;
        color: #333;
        text-decoration: none;
        vertical-align: middle; }
        ul.jqtree-tree .jqtree-toggler:hover {
          color: #000;
          text-decoration: none; }
        ul.jqtree-tree .jqtree-toggler.jqtree-closed {
          background-position: 0 0; }
        ul.jqtree-tree .jqtree-toggler.jqtree-toggler-left {
          margin-right: 0.5em; }
        ul.jqtree-tree .jqtree-toggler.jqtree-toggler-right {
          margin-left: 0.5em; }
      ul.jqtree-tree .jqtree-element {
        border: solid 1px #ccc;
        width: 100%;
        height: 32px;
        margin: 10px 0;
        padding: 2px;

        cursor: pointer;
        position: relative; }
      ul.jqtree-tree .jqtree-title {
        color: #1C4257;
        vertical-align: middle;
        }
        ul.jqtree-tree .jqtree-title.jqtree-title-folder {
          margin-left: 0; }
      ul.jqtree-tree li.jqtree-folder {
        margin-bottom: 4px; }
        ul.jqtree-tree li.jqtree-folder.jqtree-closed {
          margin-bottom: 1px; }
      ul.jqtree-tree li.jqtree-ghost {
        position: relative;
        z-index: 10;
        margin-right: 10px;
        /* todo: add classes to span? */ }
        ul.jqtree-tree li.jqtree-ghost span {
          display: block; }
        ul.jqtree-tree li.jqtree-ghost span.jqtree-circle {
          border: solid 2px #0000ff;
          -webkit-border-radius: 100px;
          -moz-border-radius: 100px;
          border-radius: 100px;
          height: 8px;
          width: 8px;
          position: absolute;
          top: -4px;
          left: -6px;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box; }
        ul.jqtree-tree li.jqtree-ghost span.jqtree-line {
          background-color: #0000ff;
          height: 2px;
          padding: 0;
          position: absolute;
          top: -1px;
          left: 2px;
          width: 100%; }
        ul.jqtree-tree li.jqtree-ghost.jqtree-inside {
          margin-left: 48px; }
      ul.jqtree-tree span.jqtree-border {

        position: absolute;
        display: block;
        left: -2px;
        top: 0;
        border: solid 2px #0000ff;
        border-radius: 6px;
        margin: 0;
        box-sizing: content-box; }
      ul.jqtree-tree li.jqtree-selected > .jqtree-element,
      ul.jqtree-tree li.jqtree-selected > .jqtree-element:hover {
        border: solid 2px #97BDD6;
        padding: 1px;
      }
      ul.jqtree-tree .jqtree-moving > .jqtree-element .jqtree-title {
        outline: dashed 1px #0000ff; }


    span.jqtree-dragging {
      color: #fff;
      background: #000;
      opacity: 0.6;
      cursor: pointer;
      padding: 2px 8px; }

    /* IE 6, 7, 8 */
    @media \0screen\,screen\9  {
      ul.jqtree-tree li.jqtree-ghost span.jqtree-circle {
        background: url(jqtree-circle.png) no-repeat;
        border: 0 none; } }


block content
  .container-fluid
    .row
      .col-md-10.col-md-offset-1
    .row
      .col-md-10.col-md-offset-1
        .menu-editor


block scripts
  script(src='/app/js/tree.jquery.js')
  script.
    (function(init) {
      init(window.jQuery, window, document);
    }(function($, window, document) {

      var inp = `<select data-placeholder="Your Favorite Football Team" style="width: 350px; display: none;" class="chosen-select" tabindex="-1">
            <option value=""></option>
            <optgroup label="NFC EAST">
              <option>Dallas Cowboys</option>
              <option>New York Giants</option>
              <option>Philadelphia Eagles</option>
              <option>Washington Redskins</option>
            </optgroup>
            <optgroup label="NFC NORTH">
              <option>Chicago Bears</option>
              <option>Detroit Lions</option>
              <option>Green Bay Packers</option>
              <option>Minnesota Vikings</option>
            </optgroup>
        </select>
            `

      function getNodeDepth(node) {
        var result = -1;
        while (node) {
          node = node.parent;
          result++;
        }
        return result;
      }

      function buildMenuNode(node, $li) {
        $('a', $li).remove()

        var depth = getNodeDepth(node)
        var span = $('span', $li)
        $(inp)
          .insertAfter(span)
          .chosen({
            width: '250px'
          })
          //.css('margin-left', -depth * 10)

        $($li).css('margin-left', depth * 10)
        //span.css('width', 500 - (depth * 20))

        //'.chosen-select'
        //console.log($li.outerHTML())
      }

      $(function() {
        var data = [
            {
                name: 'About Practice', id: 1,
                children: [
                    { name: 'Quick Information', id: 2 }
                ]
            },
            {
                name: 'Information', id: 4,
                children: [
                    { name: 'FAQ', id: 5 }
                ]
            }
        ];
        var $tree = $('.menu-editor')
        $tree.tree({
            data: data,
            autoOpen: true,
            dragAndDrop: true,
            buttonLeft: true,
            onCreateLi: buildMenuNode
        }).bind('tree.close',
          function(e) {
            $tree.tree('openNode', e.node);
          })
      });
    }));
