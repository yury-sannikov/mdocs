extends ../layouts/layout.pug

block head
  title Edit profile for #{user.displayName}

block styles
  link(rel='stylesheet', href='/app/lib/animate.css/animate.css')

block content
  .container
    header
      div(id="user-info")
    div.hidden(id="saved") The changes were saved.
    .row
      .col-sm-8.col-sm-offset-2
        #editProfileContainer

//- clientSecret: 'Att9Ez3cxbebglWBaL4hLTPWsWJEn8ml0dg4IvGPi8MF5eoewj-D74VsL5r0QM_7',

block scripts
  script(src="//cdn.auth0.com/js/lock-7.js")
  script(src="/app/js/auth0-editprofile-widget.min.js")
  
  //- Async load odometer styles
  script.
    var domain = 'movelmobile.auth0.com';
    var cid = 'SdMQqjyMjjWAM2NbxfY8BJXK28JgQ2iB';

    var editProfileWidget = new Auth0EditProfileWidget('editProfileContainer', 
      {
        domain: domain
      },
      [
      { id:"customName", type:"custom", attribute:"name", render: function(data) {
          var value = data.value || "";
          if ( value === "" ) return null;
          
          return '<div class="custom-field">Hi <b>'+value+'</b>, How you doing?</div>';
      } },
      { label: "Name", type:"text", attribute:"name", 
          validation: function(name){return (name.length > 10 ? 'The name is too long' : null);},
          onChange: function(value){ 
          
          console.log('Name changed:', value);
          editProfileWidget.updateFieldById('customName', {
              value:value
          }); 
          editProfileWidget.updateFieldById('field_text_lastname', {
              value:value + " LASTNAME"
          }); 
          }
      },
      { label: "Lastname", type:"text", attribute:"lastname" },
      { label: "BirthDay", type:"date", attribute:"birthday" },
      { label: "Email", type:"email", attribute:"email" },
      { label: "Bio", type:"textarea", attribute:"bio",
          onChange: function(value){ 
          
          console.log('Bio changed:', value);
          }
      },
      { label: "Type", type:"select", attribute:"account_type", options:[
          { value: "type_1", text:"Type 1"},
          { value: "type_2", text:"Type 2"},
          { value: "type_3", text:"Type 3"}
      ],
          onChange: function(value){ 
          
          console.log('Type changed:', value);
          }
      },
      { label: "Options", type:"radio", attribute:"account_options", options:[
          { value: "opt_1", text:"Option 1"},
          { value: "opt_2", text:"Option 2"},
          { value: "opt_3", text:"Option 3"}
      ],
          onChange: function(value){ 
          
          console.log('Options changed:', value);
          }
      },
      { label: "Checks", type:"checkbox", attribute:"account_checks", options:[
          { value: "chk_1", text:"Check 1"},
          { value: "chk_2", text:"Check 2"},
          { value: "chk_3", text:"Check 3"}
      ],
          onChange: function(value){ 
          
          console.log('Checks changed:', value);
          }
      }
      ]);
      
      var userInfoElement = document.getElementById('user-info');
      userInfoElement.innerHTML += '<img src="#{user.picture}" />';
      userInfoElement.innerHTML += '<span class="name">#{user.nickname}</span>';
      editProfileWidget
          .on('loading', function() {
            console.log('loading')
          })
          .on('loaded', function(data) {
            console.log('loaded', data)
          })
          .on('submit', function(data) {
            console.log('submited', data)
          })
          .on('save', function(data){
            console.log('saved', data);
            document.getElementById('saved').className = "";
            setTimeout(function(){
              document.getElementById('saved').className = "hidden";
            }, 3000);
          })
          .on('error', function(data){
            console.log('error', data);
          })
          .init('#{auth0Token}');
