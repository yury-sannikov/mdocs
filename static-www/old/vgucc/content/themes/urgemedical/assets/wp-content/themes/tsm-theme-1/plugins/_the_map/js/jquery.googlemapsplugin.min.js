(function(a){var b=false,c={mapOptions:{zoom:10,mapTypeControl:b,mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:5,maxZoom:15},ui:{canvas:"b2b-location-canvas",locationItems:"b2b-location-items",centerLoc:"b2b-location-center",navs:"b2b-location-nav",navUp:"b2b-location-nav .b2b-location-nav-up",navDown:"b2b-location-nav .b2b-location-nav-down",locationItemsContainer:"b2b-location-items-container",seeMore:"b2b-location-see-more"},img:{infoBoxClose:"http://townsquareinteractive.com/wp-content/themes/tsm-theme-1/plugins/_the_map/img/map-close-button.png",toolTipArrow:"http://townsquareinteractive.com/wp-content/themes/tsm-theme-1/plugins/_the_map/img/map-tooltip-arrow.png",transparentBg:"http://townsquareinteractive.com/wp-content/themes/tsm-theme-1/plugins/_the_map/img/b2b-map-overlay-bg.png",marker:"http://townsquareinteractive.com/wp-content/themes/tsm-theme-1/plugins/_the_map/img/b2b-maps-marker.png",markerShadow:"http://townsquareinteractive.com/wp-content/themes/tsm-theme-1/plugins/_the_map/img/b2b-maps-marker-shadow.png"},toolboxWidth:200,toolBoxFontSize:12,showInfoWindow:0,showDetailsOnClick:1,itemHeight:70,isAnimating:b,currentUlPosition:0,zoom:8,map:"",latlongArray:[],infoWindowArray:[],markerArray:[]};a.googleMapsPlugin=function(u){var t="click",n="px",B=".b2b-location-basic-info",A=".b2b-location-detail-info,.b2b-location-see-more",s="block",m="easeOutCubic",r="none",l="undefined",q="location",f=28,j=true;if(!u.elem)a.extend(j,c,u);else{var d=a.extend(j,{},c,u),K=d.elem,z=a(K),J=z.find("."+d.ui.canvas),i=z.find("."+d.ui.locationItems),h=i.find("ul"),e=h.find("li"),D=new google.maps.LatLngBounds,M=z.find("."+d.ui.seeMore),k="show-details",L,o,E,G=new google.maps.Geocoder,v={image:new google.maps.MarkerImage(d.img.marker,new google.maps.Size(29,29),new google.maps.Point(0,0),new google.maps.Point(15,29)),shadow:new google.maps.MarkerImage(d.img.markerShadow,new google.maps.Size(47,29),new google.maps.Point(0,0),new google.maps.Point(15,29)),shape:{coord:[19,0,21,1,23,2,24,3,25,4,26,5,26,6,27,7,27,8,f,9,f,10,f,11,f,12,f,13,f,14,f,15,f,16,f,17,f,18,f,19,27,20,27,21,26,22,26,23,25,24,24,25,23,26,21,27,19,f,9,f,7,27,5,26,4,25,3,24,2,23,2,22,1,21,1,20,0,19,0,18,0,17,0,16,0,15,0,14,0,13,0,12,0,11,0,10,0,9,1,8,1,7,2,6,2,5,3,4,4,3,5,2,7,1,9,0,19,0],type:"poly"}},C=0,y,g,F,p,x=function(a){if(d.showDetailsOnClick){typeof a.data(q)!==l&&d.map.panTo(d.latlongArray[parseInt(a.attr("data-index"),10)-1]);e.removeClass(k);h.find(".b2b-location-see-more").css({display:r});d.currentUlPosition=h.scrollTop();h.fadeOut(200,m,function(){a.addClass(k);h.css({top:"0px"});e.css({display:r});a.css({display:s});a.find(A).css({display:s});h.fadeIn(200,m)});i.addClass(k)}if(d.showInfoWindow){p=e.index(a.get(0));o&&o.close();o=d.infoWindowArray[p];o.open(d.map,d.markerArray[p])}},I=function(b,a){a.fadeOut(200,m,function(){b.removeClass(k);i.removeClass(k);e.css({display:s});a.find(A).css({display:r});a.fadeIn(200,m,function(){a.scrollTop(d.currentUlPosition)})})},w=function(b,c){if(c<b.length){var d=a(b[c]);G.geocode({address:d.attr("data-address")},function(e,a){if(a===google.maps.GeocoderStatus.OK){try{console.log(e)}catch(f){}d.data(q,e[0].geometry.location);w(b,++c)}else if(a===google.maps.GeocoderStatus.ZERO_RESULTS)w(b,++c);else a===google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&alert("Too many locations.")})}else{H();return}},H=function(){d.map=new google.maps.Map(J[0],d.mapOptions);e.each(function(){var c=a(this),f=c.data("lat"),h=c.data("long");g=c.data(q);if(typeof f!==l&&typeof h!==l)if(f!==""&&h!=="")g=new google.maps.LatLng(f,h);if(typeof g!==l){D.extend(g);if(c.hasClass(d.ui.centerLoc))F=g;d.latlongArray.push(g);y=new google.maps.Marker({position:g,icon:v.image,shadow:v.shadow,shape:v.shape,map:d.map,title:c.find(".b2b-location-basic-info > h2").html()});d.markerArray.push(y);E=new InfoBox({content:"<div style=\"margin:0px 0px 11px 0px; overflow:hidden; background:url('"+d.img.transparentBg+"'); padding:10px 15px; width:"+(d.toolboxWidth-30)+'px">'+c.find(B).html()+"</div>",boxStyle:{textAlign:"left",lineHeight:"17px",fontSize:d.toolBoxFontSize+n,width:d.toolboxWidth+n,background:"url('"+d.img.toolTipArrow+"') no-repeat center bottom",color:"#fff"},alignBottom:j,disableAutoPan:j,pixelOffset:new google.maps.Size(d.toolboxWidth/-2,-32),closeBoxMargin:"-7px -6px -10px -8px",closeBoxURL:d.img.infoBoxClose,isHidden:b,pane:"floatPane",enableEventPropagation:j});d.infoWindowArray.push(E);google.maps.event.addListener(y,t,function(b){d.map.setZoom(d.zoom+5);d.map.setCenter(b.latLng);for(g in d.latlongArray)if(d.latlongArray[g]===b.latLng)break;x(a(e[g]))})}});d.map.fitBounds(D);d.zoom=d.map.getZoom();if(e.length===1){d.map.setZoom(5);x(a(e[0]))}};w(e,0);h.delegate(B,t,function(){x(a(this).parents("li"))}).delegate("."+d.ui.seeMore,t,function(){I(a(this).parents("li"),a(this).parents("ul"))});e.each(function(){C+=e.outerHeight()+parseInt(e.css("margin-top").replace(n,""),10)+parseInt(e.css("margin-bottom").replace(n,""),10)});if(C>i.height())h.vslimScroll&&h.vslimScroll({height:i.height(),railVisible:b,alwaysVisible:b,size:"11px",color:"#5d5d5d",opacity:1,outOpacity:.6,distance:"3px",railColor:"#000000",railWidth:"17px",railOpacity:.5,railDistance:0,roundedRail:b})}};a.fn.googleMapsPlugin=function(b){return this.each(function(){b=b||{};b.elem=this;a.googleMapsPlugin(b)})};!a.easing.easeInCubic&&a.extend(a.easing,{easeInCubic:function(e,a,b,c,d){return c*(a/=d)*a*a+b}});!a.easing.easeOutCubic&&a.extend(a.easing,{easeOutCubic:function(e,a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}})})(jQuery);